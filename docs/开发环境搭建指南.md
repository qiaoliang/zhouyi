# å¼€å‘ç¯å¢ƒæ­å»ºæŒ‡å—

## ä¸€ã€Docker æ–¹å¼ï¼ˆæ¨èï¼‰

### 1. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆMongoDBã€Redisã€ç®¡ç†ç•Œé¢ï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 2. æœåŠ¡è®¿é—®

| æœåŠ¡ | åœ°å€ | ç”¨æˆ·å | å¯†ç  |
|------|------|--------|------|
| MongoDB | `localhost:27017` | `admin` | `admin123` |
| Redis | `localhost:6379` | - | `redis123` |
| MongoDB Express | http://localhost:8081 | `admin` | `admin123` |
| Redis Commander | http://localhost:8082 | - | - |

### 3. åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆæ¸…ç©ºæ•°æ®ï¼‰
docker-compose down -v
```

---

## äºŒã€æœ¬åœ°å®‰è£…æ–¹å¼

### MongoDB å®‰è£…

**macOS (Homebrew)**:
```bash
brew tap mongodb/brew
brew install mongodb-community
brew services start mongodb-community
```

**Ubuntu/Debian**:
```bash
sudo apt-get install -y mongodb
sudo systemctl start mongodb
```

**Windows**:
ä¸‹è½½å®‰è£…åŒ…ï¼šhttps://www.mongodb.com/try/download/community

### Redis å®‰è£…

**macOS (Homebrew)**:
```bash
brew install redis
brew services start redis
```

**Ubuntu/Debian**:
```bash
sudo apt-get install -y redis-server
sudo systemctl start redis
```

**Windows**:
ä¸‹è½½å®‰è£…åŒ…ï¼šhttps://github.com/microsoftarchive/redis/releases

---

## ä¸‰ã€ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®ï¼š

```bash
# MongoDB
MONGODB_URI="mongodb://localhost:27017/zhouyi"

# Redis
REDIS_HOST="localhost"
REDIS_PORT="6379"
REDIS_PASSWORD="redis123"
REDIS_DB="0"
```

---

## å››ã€å¯åŠ¨åº”ç”¨

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run start:dev
```

åº”ç”¨å°†è¿è¡Œåœ¨ï¼šhttp://localhost:3000

---

## äº”ã€æµ‹è¯• API

### 1. å‘é€éªŒè¯ç 

```bash
curl -X POST http://localhost:3000/api/v1/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "13800138000"}'
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "expiresAt": 1704960300
  },
  "message": "éªŒè¯ç å‘é€æˆåŠŸ"
}
```

éªŒè¯ç ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚   ğŸ“± æ¨¡æ‹ŸçŸ­ä¿¡å‘é€                        â”‚
â”‚                                         â”‚
â”‚   æ‰‹æœºå·: 138****8000
â”‚   éªŒè¯ç : 123456
â”‚   æœ‰æ•ˆæœŸ: 5åˆ†é’Ÿ                          â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ä½¿ç”¨éªŒè¯ç ç™»å½•

```bash
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "13800138000", "code": "123456"}'
```

---

## å…­ã€ç®¡ç†ç•Œé¢

### MongoDB Express (Webç®¡ç†)

è®¿é—®ï¼šhttp://localhost:8081

å¯ä»¥æŸ¥çœ‹å’Œç®¡ç† MongoDB æ•°æ®ï¼š

- æŸ¥çœ‹ç”¨æˆ·æ•°æ® (`zhouyi` æ•°æ®åº“ â†’ `users` é›†åˆ)
- æ‰§è¡ŒæŸ¥è¯¢
- æŸ¥çœ‹ç´¢å¼•

### Redis Commander (Webç®¡ç†)

è®¿é—®ï¼šhttp://localhost:8082

å¯ä»¥æŸ¥çœ‹å’Œç®¡ç† Redis æ•°æ®ï¼š

- æŸ¥çœ‹æ‰€æœ‰é”®
- æŸ¥çœ‹éªŒè¯ç å­˜å‚¨ (`sms:code:*`)
- æŸ¥çœ‹é¢‘ç‡é™åˆ¶ (`sms:rate:*`)

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### Docker ç›¸å…³

**Q: ç«¯å£è¢«å ç”¨**
```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :27017
lsof -i :6379

# æ€æ‰å ç”¨è¿›ç¨‹
kill -9 <PID>
```

**Q: å®¹å™¨å¯åŠ¨å¤±è´¥**
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs mongodb
docker-compose logs redis

# é‡æ–°æ„å»º
docker-compose down
docker-compose up -d --build
```

### åº”ç”¨è¿æ¥é—®é¢˜

**Q: æ— æ³•è¿æ¥ MongoDB**
- æ£€æŸ¥ Docker å®¹å™¨æ˜¯å¦è¿è¡Œï¼š`docker ps`
- æ£€æŸ¥ `.env` ä¸­çš„ `MONGODB_URI` æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ MongoDB æ˜¯å¦åœ¨ 27017 ç«¯å£ç›‘å¬

**Q: æ— æ³•è¿æ¥ Redis**
- æ£€æŸ¥ Docker å®¹å™¨æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥ `.env` ä¸­çš„ Redis é…ç½®
- æµ‹è¯•è¿æ¥ï¼š`redis-cli -h localhost -p 6379 -a redis123 ping`

---

## å…«ã€æ•°æ®æ¸…ç†

### æ¸…ç©ºæ•°æ®åº“æ•°æ®

```bash
# MongoDB
docker exec -it zhouyi-mongodb mongosh --eval "use zhouyi; db.dropDatabase()"

# Redis
docker exec -it zhouyi-redis redis-cli -a redis123 FLUSHALL
```

### é‡ç½®æ‰€æœ‰æ•°æ®

```bash
# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æ•°æ®å’Œå®¹å™¨
docker-compose down -v

# é‡æ–°å¯åŠ¨
docker-compose up -d
```
