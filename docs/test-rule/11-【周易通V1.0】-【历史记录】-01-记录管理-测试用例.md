# 【周易通V1.0】-【历史记录】-记录管理测试用例

## 文档信息

| 项目 | 内容 |
|------|------|
| 模块名称 | 历史记录 - 记录管理 |
| 文档版本 | v1.0 |
| 编写日期 | 2026-01-14 |
| 文档状态 | 待评审 |

---

## 历史记录功能

### 查看历史记录

#### 查看历史记录-免费用户 ZYT-HIST-001

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 免费用户已登录
2. 有卜卦记录

**测试步骤**：
1. 点击底部导航栏"历史"Tab
2. 进入历史记录页面
3. 查看卜卦记录列表

**预期结果**：
1. 显示卜卦记录列表（卡片式）
2. 每条记录显示：
   - 日期和时间
   - 卦象符号
   - 卦象名称
   - 简短结果
3. 只显示最近1条记录（免费用户限制）
4. 按时间倒序排列
5. 显示提示"免费用户仅保存最近1条记录"

**备注**：
- 免费用户仅1条记录
- 保存1个月
- 关联需求：PRD-3.6.2

---

#### 查看历史记录-会员用户 ZYT-HIST-002

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户已登录
2. 有多条卜卦记录

**测试步骤**：
1. 点击底部导航栏"历史"Tab
2. 查看历史记录列表

**预期结果**：
1. 显示所有卜卦记录（无限制）
2. 按时间倒序排列
3. 支持分页加载（每页20条）
4. 显示记录总数
5. 每条记录可点击查看详情

**备注**：
- 会员无记录数量限制
- 永久保存
- 关联需求：PRD-3.6.2

---

#### 查看历史记录-游客 ZYT-HIST-003

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 游客模式
2. 有游客卜卦记录

**测试步骤**：
1. 点击底部导航栏"历史"Tab
2. 查看历史记录

**预期结果**：
1. 可查看游客期间的卜卦记录
2. 显示记录（≤2条）
3. 提示"登录后永久保存"
4. 引导登录

**备注**：
- 游客记录30天后删除
- 不持久保存

---

### 记录详情

#### 查看记录详情-完整展示 ZYT-HIST-004

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 已登录或游客
2. 有卜卦记录

**测试步骤**：
1. 在历史记录列表中
2. 点击某条记录
3. 查看详情页面

**预期结果**：
1. 显示完整卦象信息：
   - 主卦名称和符号
   - 六爻阴阳属性
   - 变爻信息
2. 显示基础解卦内容：
   - 卦辞原文
   - 爻辞原文
   - 白话解释
3. 显示起卦时间
4. 显示卜卦方式（金钱课/一键起卦）
5. 提供"重新解读"按钮

**备注**：
- 基础解卦所有用户可见
- 详细解卦需付费

---

#### 记录详情-查看详细解卦 ZYT-HIST-005

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 查看历史记录详情
2. 该记录未购买详细解卦

**测试步骤**：
1. 在记录详情页
2. 点击"查看详细解卦"按钮

**预期结果**：
1. 会员用户：直接显示详细解卦内容
2. 免费用户：弹出付费引导弹窗
3. 提供"单次购买 ¥10"选项
4. 提供"开通会员"选项
5. 购买后可查看

**备注**：
- 详细解卦为付费内容
- 单次购买或会员

---

#### 记录详情-已购买详细解卦 ZYT-HIST-006

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 该记录已购买详细解卦

**测试步骤**：
1. 在记录详情页
2. 点击"查看详细解卦"

**预期结果**：
1. 直接显示详细解卦内容
2. 提示"您已购买此详细解卦"
3. 显示变卦分析
4. 显示互卦分析
5. 显示应期分析
6. 无需再次付费

**备注**：
- 已购买记录可永久查看
- 不重复收费

---

### 收藏功能

#### 收藏记录-添加收藏 ZYT-HIST-007

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 查看历史记录详情

**测试步骤**：
1. 在记录详情页
2. 点击"收藏"按钮
3. 查看收藏状态

**预期结果**：
1. 收藏按钮变为实心
2. 提示"已收藏"
3. 记录isFavorite字段更新为true
4. 可在"我的收藏"中查看

**备注**：
- 会员专享功能
- 收藏便于查找

---

#### 收藏记录-取消收藏 ZYT-HIST-008

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 记录已收藏

**测试步骤**：
1. 在记录详情页
2. 点击"收藏"按钮（实心）
3. 查看状态

**预期结果**：
1. 收藏按钮变为空心
2. 提示"已取消收藏"
3. 记录isFavorite字段更新为false
4. 从"我的收藏"中移除

**备注**：
- 支持取消收藏

---

#### 查看收藏列表-会员用户 ZYT-HIST-009

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 有收藏的记录

**测试步骤**：
1. 进入历史记录页面
2. 点击"我的收藏"Tab
3. 查看收藏列表

**预期结果**：
1. 显示所有收藏的记录
2. 按收藏时间倒序
3. 显示记录基本信息
4. 可点击查看详情
5. 显示收藏数量

**备注**：
- 会员功能
- 快速访问重要记录

---

### 删除记录

#### 删除记录-会员单条删除 ZYT-HIST-010

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 有历史记录

**测试步骤**：
1. 在历史记录列表
2. 长按某条记录
3. 选择"删除"
4. 确认删除

**预期结果**：
1. 弹出确认提示："确定删除此记录？"
2. 确认后记录删除
3. 列表更新
4. 提示"删除成功"
5. 数据库中记录已删除

**备注**：
- 会员可删除记录
- 支持单条删除

---

#### 删除记录-会员清空全部 ZYT-HIST-011

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 有多条记录

**测试步骤**：
1. 进入历史记录页面
2. 点击"清空"或"管理"按钮
3. 选择"清空全部记录"
4. 确认清空

**预期结果**：
1. 弹出二次确认："清空后无法恢复，确认清空？"
2. 确认后所有记录删除
3. 列表为空
4. 提示"已清空全部记录"

**备注**：
- 会员可清空全部
- 二次确认防误操作

---

#### 删除记录-免费用户限制 ZYT-HIST-012

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 免费用户
2. 有1条历史记录

**测试步骤**：
1. 在历史记录页面
2. 尝试删除记录

**预期结果**：
1. 删除按钮不可见或不可点击
2. 或提示"免费用户无法删除记录"
3. 无法删除记录
4. 引导购买会员

**备注**：
- 免费用户无删除权限
- 会员权益

---

### 数据同步

#### 数据同步-多设备同步 ZYT-HIST-013

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 在设备A上有记录

**测试步骤**：
1. 在设备B登录同一账号
2. 进入历史记录页面

**预期结果**：
1. 显示设备A的所有记录
2. 记录内容一致
3. 同步延迟<3秒
4. 显示同步状态

**备注**：
- 支持云端同步
- 多设备数据一致
- 关联需求：PRD-3.6.3

---

#### 数据同步-离线查看 ZYT-HIST-014

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 已有历史记录

**测试步骤**：
1. 断开网络
2. 进入历史记录页面
3. 查看记录详情

**预期结果**：
1. 可查看已缓存的记录列表
2. 可查看基础解卦内容
3. 显示"离线模式"提示
4. 无法加载新内容时提示

**备注**：
- 支持离线查看
- 已缓存内容可访问
- 关联需求：PRD-4.5

---

## 附录

### 测试数据

| 数据类型 | 示例值 | 用途 |
|---------|--------|------|
| 卜卦记录ID | record_001 | 记录查询 |
| 卦象数据 | 乾为天（䷀） | 记录内容 |
| 收藏状态 | 已收藏/未收藏 | 收藏测试 |

### 历史记录数据结构

```typescript
{
  userId: "user_001",
  hexagram: { /* 卦象数据 */ },
  interpretation: { /* 解卦数据 */ },
  payment: {
    type: 'free' | 'single' | 'membership',
    status: 'paid' | 'unpaid'
  },
  isFavorite: false,
  createdAt: "2026-01-14T10:00:00Z"
}
```

### 测试环境要求

| 环境项 | 要求 |
|--------|------|
| 数据库 | MongoDB |
| 云存储 | 支持云端同步 |
| 网络 | 在线/离线环境 |

### 相关文档

- PRD文档：`.taskmaster/docs/prd.md`
- 测试用例组织规则：`docs/test-rule/00-【周易通V1.0】测试用例组织规则.md`
- 卜卦Schema：`src/database/schemas/divination-record.schema.ts`

---

## 更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| v1.0 | 2026-01-14 | 初始版本，完成14条测试用例设计 | Claude |
