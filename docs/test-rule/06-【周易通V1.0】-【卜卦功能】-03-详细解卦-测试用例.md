# 【周易通V1.0】-【卜卦功能】-详细解卦测试用例

## 文档信息

| 项目 | 内容 |
|------|------|
| 模块名称 | 卜卦功能 - 详细解卦 |
| 文档版本 | v1.0 |
| 编写日期 | 2026-01-14 |
| 文档状态 | 待评审 |

---

## 详细解卦功能

### 会员访问控制

#### 查看详细解卦-会员用户 ZYT-DIV-031

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录（付费会员）
2. 会员未过期
3. 已完成起卦
4. 网络连接正常

**测试步骤**：
1. 会员用户完成起卦
2. 在基础解卦页面
3. 点击"查看详细解卦"按钮
4. 查看详细解卦内容

**预期结果**：
1. 成功进入详细解卦页面
2. 显示包含基础解卦的所有内容
3. 显示变卦分析（如有变爻）
4. 显示互卦分析
5. 显示应期分析
6. 显示综合建议
7. 无付费引导弹窗
8. 所有内容完整展示

**备注**：
- 详细解卦为会员专享功能
- 需要通过会员权限验证（SubscriptionGuard）
- 关联需求：PRD-3.3.3

---

#### 查看详细解卦-免费用户-弹窗引导 ZYT-DIV-032

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录（免费用户）
2. 已完成起卦

**测试步骤**：
1. 免费用户完成起卦
2. 在基础解卦页面
3. 点击"查看详细解卦"按钮

**预期结果**：
1. 弹出付费引导弹窗
2. 弹窗标题："此功能为会员专享"
3. 显示会员权益列表：
   - 变卦分析
   - 互卦分析
   - 应期分析
   - 精准解卦
   - 无广告体验
4. 提供"查看会员权益"按钮
5. 提供"立即开通"按钮
6. 提供"暂不开通"按钮（关闭弹窗）
7. 点击"立即开通"跳转至会员购买页面

**备注**：
- 免费用户需付费才能查看
- 引导购买会员
- 关联需求：PRD-3.3.5

---

#### 查看详细解卦-游客-引导登录 ZYT-DIV-033

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户未登录（游客模式）
2. 已完成起卦

**测试步骤**：
1. 游客完成起卦
2. 在基础解卦页面
3. 点击"查看详细解卦"按钮

**预期结果**：
1. 弹出登录引导弹窗
2. 提示"请先登录"
3. 说明"登录后可查看详细解卦"
4. 提供"立即登录"按钮
5. 点击后跳转至登录页面

**备注**：
- 游客必须先登录
- 登录后可购买会员
- 两步引导

---

### 变卦分析

#### 变卦分析-有变爻 ZYT-DIV-034

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 起得有变爻的卦象（如2个变爻）

**测试步骤**：
1. 查看详细解卦页面
2. 找到变卦分析区域

**预期结果**：
1. 标题显示"变卦分析"
2. 说明主卦变为变卦的过程
3. 列出变爻位置（如"二爻、三爻为变爻"）
4. 解释每个变爻的含义
5. 分析变卦与主卦的关系
6. 说明事物发展趋势
7. 内容专业且易懂

**备注**：
- 变卦分析是详细解卦的核心内容
- 需专业周易知识支持
- 关联需求：PRD-3.3.3

---

#### 变卦分析-无变爻（静卦） ZYT-DIV-035

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 起得无变爻的卦象（静卦）

**测试步骤**：
1. 查看详细解卦页面
2. 找到变卦分析区域

**预期结果**：
1. 显示"此卦为静卦，无变爻"
2. 说明"卦象稳定，事情发展平稳"
3. 分析当前状态保持的意义
4. 给出稳定发展建议
5. 不显示变卦对比

**备注**：
- 静卦约占6.25%
- 特殊情况处理

---

#### 变卦分析-全部变爻 ZYT-DIV-036

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 起得六爻皆变的卦象

**测试步骤**：
1. 查看详细解卦页面
2. 找到变卦分析区域

**预期结果**：
1. 显示"此卦六爻皆动"
2. 说明"事情将发生根本性变化"
3. 分析主卦与变卦的完全相反关系
4. 解释物极必反的道理
5. 给出应对重大变化建议
6. 强调把握时机的重要性

**备注**：
- 全变爻卦约占3.125%
- 特殊卦象特殊分析

---

### 互卦分析

#### 互卦分析-标准卦象 ZYT-DIV-037

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已完成起卦

**测试步骤**：
1. 查看详细解卦页面
2. 找到互卦分析区域

**预期结果**：
1. 标题显示"互卦分析"
2. 说明互卦含义（二三四爻为下卦，三四五爻为上卦）
3. 显示互卦名称和符号
4. 解释互卦与主卦的内在联系
5. 分析事物发展的中间过程
6. 说明当前阶段的特征
7. 内容专业准确

**备注**：
- 互卦分析是详细解卦重要内容
- 需专业周易知识
- 关联需求：PRD-3.3.3

---

#### 互卦分析-特殊卦象 ZYT-DIV-038

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 起得特殊卦象（如纯阳、纯阴）

**测试步骤**：
1. 查看详细解卦页面
2. 找到互卦分析区域

**预期结果**：
1. 互卦与主卦可能相同
2. 说明特殊情况下的互卦含义
3. 解释纯阳纯阴卦的互卦特点
4. 内容准确专业

**备注**：
- 某些卦象的互卦可能与主卦相同
- 特殊情况特殊处理

---

### 应期分析

#### 应期分析-有变爻 ZYT-DIV-039

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 起得有变爻的卦象

**测试步骤**：
1. 查看详细解卦页面
2. 找到应期分析区域

**预期结果**：
1. 标题显示"应期分析"
2. 说明预测应验的时间范围
3. 根据变爻位置给出时间提示（如"应在近期"）
4. 根据卦象性质给出时机建议
5. 提醒"应期仅为参考，实际还需结合具体情况"
6. 内容合理专业

**备注**：
- 应期分析是传统解卦重要内容
- 需专业周易知识
- 关联需求：PRD-3.3.3

---

#### 应期分析-无变爻 ZYT-DIV-040

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 起得无变爻的卦象

**测试步骤**：
1. 查看详细解卦页面
2. 找到应期分析区域

**预期结果**：
1. 显示"此卦为静卦，时机尚未成熟"
2. 建议"耐心等待，不宜急于求成"
3. 说明稳守的重要性
4. 给出等待时机的建议

**备注**：
- 静卦的应期分析
- 与有变爻卦象不同

---

### 综合建议

#### 综合建议-完整呈现 ZYT-DIV-041

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已完成起卦

**测试步骤**：
1. 查看详细解卦页面
2. 找到综合建议区域

**预期结果**：
1. 标题显示"综合建议"
2. 总结主卦整体含义
3. 结合变卦、互卦给出建议
4. 考虑应期给出行动时机
5. 语言通俗易懂
6. 建议具有可操作性
7. 结构清晰，分点陈述

**备注**：
- 综合建议是详细解卦的总结
- 整合所有分析内容
- 给出明确建议

---

#### 综合建议-个性化（基于占问事项） ZYT-DIV-042

**优先级**：低
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 用户已填写占问事项（精准解卦信息）

**测试步骤**：
1. 查看详细解卦页面
2. 找到综合建议区域

**预期结果**：
1. 建议结合用户占问事项
2. 针对具体问题给出分析
3. 提及用户所问之事
4. 建议更加个性化

**备注**：
- 需配合精准解卦功能
- 个性化体验
- 低优先级（后续优化）

---

### 单次付费

#### 单次购买详细解卦-免费用户 ZYT-DIV-043

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 免费用户
2. 已完成起卦
3. 支付功能可用

**测试步骤**：
1. 在基础解卦页面
2. 点击"查看详细解卦"
3. 在付费引导弹窗中
4. 选择"单次购买 ¥10"
5. 完成支付流程

**预期结果**：
1. 创建支付订单
2. 订单金额10元
3. 支付成功后解锁该次详细解卦
4. 可立即查看详细解卦内容
5. 记录保存支付信息
6. 历史记录中标记为"已购买"

**备注**：
- 单次购买选项（非会员）
- 价格：10元/次
- 关联需求：PRD-3.7.2

---

#### 单次购买-已购买记录 ZYT-DIV-044

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 免费用户
2. 已购买过某次详细解卦

**测试步骤**：
1. 进入历史记录
2. 找到已购买的记录
3. 点击查看详细解卦

**预期结果**：
1. 无需再次付费
2. 直接显示详细解卦内容
3. 提示"您已购买此详细解卦"
4. 记录状态为"已付费"

**备注**：
- 已购买记录可永久查看
- 不重复收费

---

### 页面展示

#### 详细解卦页面布局-清晰美观 ZYT-DIV-045

**优先级**：中
**测试类型**：UI

**前置条件**：
1. 会员用户
2. 已进入详细解卦页面

**测试步骤**：
1. 浏览整个页面
2. 检查各模块布局

**预期结果**：
1. 页面标题清晰
2. 各模块有明确分隔：
   - 基础解卦（卦名、卦辞、爻辞）
   - 变卦分析
   - 互卦分析
   - 应期分析
   - 综合建议
3. 使用中国风设计元素
4. 配色和谐统一
5. 文字大小适宜阅读
6. 重点内容突出显示

**备注**：
- 中国风UI设计
- 用户体验优化
- 关联需求：PRD-4.1.1

---

#### 详细解卦内容-加载速度 ZYT-DIV-046

**优先级**：中
**测试类型**：性能

**前置条件**：
1. 会员用户

**测试步骤**：
1. 点击"查看详细解卦"
2. 记录页面加载时间

**预期结果**：
1. 页面在2秒内完全加载
2. 内容逐步显示（优化体验）
3. 无长时间白屏
4. 无卡顿

**备注**：
- 性能优化
- 用户体验
- 关联需求：PRD-4.3

---

## 附录

### 测试数据

| 数据类型 | 示例值 | 用途 |
|---------|--------|------|
| 会员用户ID | user_member_001 | 会员功能测试 |
| 免费用户ID | user_free_001 | 付费引导测试 |
| 有变爻卦象 | 水雷屯（䷂）2爻变 | 变卦分析测试 |
| 静卦 | 乾为天（䷀）无变爻 | 特殊卦象测试 |

### 会员权益说明

| 会员类型 | 价格 | 详细解卦 | 其他权益 |
|---------|------|----------|----------|
| 月卡 | 30元/月 | ✅ | 精准解卦、无广告 |
| 季卡 | 80元/季 | ✅ | 精准解卦、无广告 |
| 年卡 | 300元/年 | ✅ | 精准解卦、无广告 |
| 单次购买 | 10元/次 | ✅ | 仅当次有效 |

### 详细解卦数据结构

```typescript
{
  changingAnalysis: string,  // 变卦分析
  mutualAnalysis: string,    // 互卦分析
  timingAnalysis: string,    // 应期分析
  advice: string             // 综合建议
}
```

### 测试环境要求

| 环境项 | 要求 |
|--------|------|
| 会员系统 | 可用，支持权限验证 |
| 支付系统 | 可用（测试单次购买） |
| 数据库 | 包含详细解卦分析数据 |
| 网络 | 正常网络 |

### 相关文档

- PRD文档：`.taskmaster/docs/prd.md`
- 测试用例组织规则：`docs/test-rule/00-【周易通V1.0】测试用例组织规则.md`
- 会员守卫：`src/modules/membership/guards/subscription.guard.ts`
- 卜卦控制器：`src/modules/divination/divination.controller.ts`

---

## 更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| v1.0 | 2026-01-14 | 初始版本，完成16条测试用例设计 | Claude |
