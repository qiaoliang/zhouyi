# 【周易通V1.0】-【卜卦功能】-精准解卦测试用例

## 文档信息

| 项目 | 内容 |
|------|------|
| 模块名称 | 卜卦功能 - 精准解卦 |
| 文档版本 | v1.0 |
| 编写日期 | 2026-01-14 |
| 文档状态 | 待评审 |

---

## 精准信息收集

### 填写精准信息表单

#### 填写精准信息-完整信息 ZYT-DIV-047

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已完成起卦
3. 网络连接正常

**测试步骤**：
1. 在基础解卦页面
2. 点击"精准解卦"或"个性化解读"按钮
3. 进入精准信息填写页面
4. 填写姓名："张三"
5. 选择性别："男"
6. 选择出生日期：1990-01-01（公历）
7. 填写占问事项："事业发展"
8. 点击"提交"按钮

**预期结果**：
1. 表单页面布局清晰
2. 所有字段都有明确标注
3. 姓名输入框支持中英文
4. 性别选择：男/女（单选）
5. 出生日期支持日期选择器
6. 支持农历/公历切换
7. 占问事项为文本输入框
8. 点击提交后显示"保存成功"
9. 精准信息保存至数据库
10. 返回卜卦记录详情页

**备注**：
- 精准解卦需收集用户个人信息
- 基于生辰八字进行个性化分析
- 关联需求：PRD-3.3.4

---

#### 填写精准信息-姓名为空 ZYT-DIV-048

**优先级**：中
**测试类型**：异常

**前置条件**：
1. 会员用户
2. 已完成起卦

**测试步骤**：
1. 进入精准信息填写页面
2. 不填写姓名
3. 填写其他信息
4. 点击"提交"按钮

**预期结果**：
1. 前端表单验证拦截
2. 提示"请输入姓名"
3. 高亮姓名输入框
4. 不提交表单
5. 页面停留在当前表单页

**备注**：
- 姓名为必填项
- 表单验证

---

#### 填写精准信息-性别未选 ZYT-DIV-049

**优先级**：中
**测试类型**：异常

**前置条件**：
1. 会员用户
2. 已完成起卦

**测试步骤**：
1. 进入精准信息填写页面
2. 填写姓名
3. 不选择性别
4. 点击"提交"按钮

**预期结果**：
1. 前端表单验证拦截
2. 提示"请选择性别"
3. 高亮性别选项
4. 不提交表单

**备注**：
- 性别为必选项
- 表单验证

---

#### 填写精准信息-出生日期未填 ZYT-DIV-050

**优先级**：中
**测试类型**：异常

**前置条件**：
1. 会员用户
2. 已完成起卦

**测试步骤**：
1. 进入精准信息填写页面
2. 填写姓名、性别
3. 不选择出生日期
4. 点击"提交"按钮

**预期结果**：
1. 前端表单验证拦截
2. 提示"请选择出生日期"
3. 高亮日期选择器
4. 不提交表单

**备注**：
- 出生日期为必填项
- 用于计算生辰八字

---

#### 填写精准信息-占问事项为空 ZYT-DIV-051

**优先级**：中
**测试类型**：异常

**前置条件**：
1. 会员用户
2. 已完成起卦

**测试步骤**：
1. 进入精准信息填写页面
2. 填写姓名、性别、出生日期
3. 不填写占问事项
4. 点击"提交"按钮

**预期结果**：
1. 前端表单验证拦截
2. 提示"请填写占问事项"
3. 高亮占问事项输入框
4. 不提交表单

**备注**：
- 占问事项为必填项
- 个性化解读需要

---

### 农历日期支持

#### 选择农历出生日期 ZYT-DIV-052

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已进入精准信息填写页面

**测试步骤**：
1. 找到出生日期选择区域
2. 点击"农历/公历"切换按钮
3. 切换到农历模式
4. 选择农历日期：如"1990年正月初一"
5. 查看选择的日期显示

**预期结果**：
1. 支持农历/公历切换
2. 农历模式显示农历历法
3. 可选择农历年、月、日
4. 日期显示为农历格式（如"庚午年正月初一"）
5. 提交后正确转换为公历存储

**备注**：
- 支持农历输入
- 自动转换公历
- 关联需求：PRD-3.3.4

---

#### 农历转公历-转换正确 ZYT-DIV-053

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 已选择农历日期

**测试步骤**：
1. 选择农历日期：1990年正月初一
2. 提交表单
3. 查看数据库中存储的日期

**预期结果**：
1. 数据库中birthDate字段存储为公历
2. 公历日期正确：1990-01-27（示例）
3. 转换算法准确无误
4. 后续计算年龄使用公历日期

**备注**：
- 农历公历转换算法
- 数据验证

---

### 占问事项输入

#### 占问事项-短文本 ZYT-DIV-054

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 已进入精准信息填写页面

**测试步骤**：
1. 在占问事项输入框输入："事业"
2. 提交表单

**预期结果**：
1. 允许输入短文本
2. 提交成功
3. 占问事项保存为"事业"

**备注**：
- 支持简短占问
- 灵活输入

---

#### 占问事项-长文本 ZYT-DIV-055

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 已进入精准信息填写页面

**测试步骤**：
1. 在占问事项输入框输入："我想了解我未来三年的事业发展情况，是否会遇到升职机会，以及是否适合跳槽"
2. 提交表单

**预期结果**：
1. 允许输入长文本
2. 提交成功
3. 长文本完整保存
4. 解卦时针对详细问题分析

**备注**：
- 支持详细描述
- 字符限制：200字以内

---

#### 占问事项-特殊字符 ZYT-DIV-056

**优先级**：低
**测试类型**：异常

**前置条件**：
1. 已进入精准信息填写页面

**测试步骤**：
1. 在占问事项输入框输入特殊字符：!@#$%^&*()
2. 提交表单

**预期结果**：
1. 前端过滤特殊字符（或提示）
2. 或允许特殊字符输入
3. 后端正确处理
4. 不影响解卦结果

**备注**：
- 特殊字符处理
- 低优先级

---

## 查看精准解卦

### 会员查看精准解卦

#### 查看精准解卦-成功 ZYT-DIV-057

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已填写精准信息
3. 网络连接正常

**测试步骤**：
1. 在卜卦记录详情页
2. 点击"查看精准解卦"按钮
3. 查看精准解卦内容

**预期结果**：
1. 成功进入精准解卦页面
2. 显示标题："【精准解卦 - 为张三先生/女士量身定制】"
3. 显示占问事项："事业发展"
4. 显示所得卦象："乾为天（䷀）"
5. 显示个性化解读：
   - 根据年龄给出建议
   - 根据性别给出建议
   - 根据卦象性质给出建议
   - 针对占问事项给出具体建议
6. 显示"致张三的建议"部分
7. 内容专业且个性化
8. 无付费引导

**备注**：
- 基于个人信息生成个性化解读
- 需专业周易知识支持
- 关联需求：PRD-3.3.4

---

#### 精准解卦-年龄分析 ZYT-DIV-058

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已填写出生日期

**测试步骤**：
1. 查看精准解卦内容
2. 找到年龄相关分析

**预期结果**：
1. 系统自动计算年龄
2. 根据年龄段给出不同建议：
   - 30岁以下："您正值青春年华..."
   - 30-50岁："您处于人生黄金时期..."
   - 50岁以上："您阅历丰富..."
3. 年龄分析准确
4. 建议符合年龄段特征

**备注**：
- 年龄自动计算
- 个性化建议

---

#### 精准解卦-性别分析 ZYT-DIV-059

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已填写性别

**测试步骤**：
1. 查看精准解卦内容
2. 检查性别相关描述

**预期结果**：
1. 称呼准确："先生"或"女士"
2. 根据性别给出不同侧重点的建议（如适用）
3. 性别分析得体

**备注**：
- 性别差异分析
- 个性化体验

---

#### 精准解卦-生辰八字（隐含） ZYT-DIV-060

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已填写出生日期

**测试步骤**：
1. 查看精准解卦内容
2. 检查是否包含八字分析

**预期结果**：
1. 基于出生日期计算八字
2. 八字信息隐含在解读中
3. 不直接显示八字（专业术语）
4. 解读融入八字分析结果

**备注**：
- 八字分析专业性强
- 不直接展示专业术语
- 融入解读中

---

### 个性化建议

#### 个性化建议-针对具体问题 ZYT-DIV-061

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 占问事项："事业发展"

**测试步骤**：
1. 查看精准解卦内容
2. 找到个性化建议部分

**预期结果**：
1. 明确提及"关于'事业发展'这个问题"
2. 建议针对事业问题展开
3. 结合卦象给出事业方面的具体建议
4. 不泛泛而谈
5. 建议具有可操作性

**备注**：
- 针对性建议
- 实用性强

---

#### 个性化建议-称谓个性化 ZYT-DIV-062

**优先级**：低
**测试类型**：功能

**前置条件**：
1. 会员用户
2. 已填写姓名

**测试步骤**：
1. 查看精准解卦内容
2. 检查称谓使用

**预期结果**：
1. 多处使用用户姓名
2. 如"【致张三的建议】"
3. 如"针对'事业发展'这个问题，张三..."
4. 增强个性化体验

**备注**：
- 称谓个性化
- 提升用户体验
- 低优先级

---

### 免费用户访问

#### 查看精准解卦-免费用户-引导购买 ZYT-DIV-063

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 免费用户
2. 已填写精准信息（如有）

**测试步骤**：
1. 免费用户完成起卦
2. 点击"精准解卦"按钮

**预期结果**：
1. 弹出付费引导弹窗
2. 提示"精准解卦为会员专享功能"
3. 说明权益："基于您的生辰八字和占问事项进行个性化解读"
4. 提供"立即开通"按钮
5. 提供"查看会员权益"按钮
6. 点击后跳转至会员购买页面

**备注**：
- 精准解卦为会员专享
- 引导购买会员
- 与详细解卦相同权限控制

---

#### 填写精准信息-免费用户限制 ZYT-DIV-064

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 免费用户
2. 已完成起卦

**测试步骤**：
1. 免费用户点击"精准解卦"
2. 在引导弹窗中选择"暂不开通"

**预期结果**：
1. 允许填写精准信息
2. 填写后保存成功
3. 但无法查看精准解卦结果
4. 提示"购买会员后即可查看"
5. 信息保存，购买后可直接查看

**备注**：
- 允许提前填写信息
- 购买后解锁查看
- 降低购买门槛

---

## 附录

### 测试数据

| 数据类型 | 示例值 | 用途 |
|---------|--------|------|
| 姓名 | 张三 | 正常输入 |
| 性别 | 男/女 | 性别选择 |
| 公历日期 | 1990-01-01 | 公历输入 |
| 农历日期 | 1990年正月初一 | 农历输入 |
| 占问事项 | 事业发展 | 短文本 |
| 占问事项 | 未来三年事业发展情况 | 长文本 |

### 精准信息数据结构

```typescript
{
  name: string,           // 姓名
  gender: 'male' | 'female',
  birthDate: Date,        // 出生日期（公历）
  question: string        // 占问事项
}
```

### 精准解卦生成逻辑

| 信息项 | 用途 | 示例 |
|--------|------|------|
| 姓名 | 个性化称谓 | "致张三的建议" |
| 性别 | 称谓、建议倾向 | "先生/女士" |
| 出生日期 | 计算年龄、八字 | 年龄分段建议 |
| 占问事项 | 针对性建议 | 事业、感情、健康 |
| 卦象 | 核心分析基础 | 卦象性质解读 |

### 年龄分段建议

| 年龄段 | 建议倾向 | 示例文案 |
|--------|----------|----------|
| <30岁 | 积极进取 | "您正值青春年华，..." |
| 30-50岁 | 稳中求进 | "您处于人生黄金时期，..." |
| >50岁 | 经验传承 | "您阅历丰富，..." |

### 测试环境要求

| 环境项 | 要求 |
|--------|------|
| 会员系统 | 可用 |
| 农历转换 | 农历公历转换算法准确 |
| 数据库 | 支持精准信息存储 |
| 网络 | 正常网络 |

### 相关文档

- PRD文档：`.taskmaster/docs/prd.md`
- 测试用例组织规则：`docs/test-rule/00-【周易通V1.0】测试用例组织规则.md`
- 卜卦服务：`src/modules/divination/divination.service.ts`
- 精准信息DTO：`src/modules/divination/dto/precise-interpretation.dto.ts`

---

## 更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| v1.0 | 2026-01-14 | 初始版本，完成18条测试用例设计 | Claude |
