# 【周易通V1.0】-【用户系统】-个人中心测试用例

## 文档信息

| 项目 | 内容 |
|------|------|
| 模块名称 | 用户系统 - 个人中心 |
| 文档版本 | v1.0 |
| 编写日期 | 2026-01-14 |
| 文档状态 | 待评审 |

---

## 用户信息展示

### 查看个人中心页面

#### 查看个人中心-免费用户 ZYT-USER-021

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 用户为免费用户（未购买会员）
3. 网络连接正常

**测试步骤**：
1. 打开周易通APP
2. 点击底部导航栏"我的"Tab
3. 进入个人中心页面

**预期结果**：
1. 成功进入个人中心页面
2. 显示用户头像和昵称
3. 显示手机号（脱敏显示，如138****8000）
4. 会员状态显示"免费用户"
5. 显示学习进度（如"已完成1/5课程"）
6. 显示卜卦次数统计
7. 显示会员购买入口
8. 各功能模块入口正常显示（设置、反馈、客服等）

**备注**：
- 免费用户需引导购买会员
- 关联需求：PRD-3.2.4

---

#### 查看个人中心-月卡会员（未过期） ZYT-USER-022

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 用户为月卡会员，会员未过期
3. 网络连接正常

**测试步骤**：
1. 打开周易通APP
2. 点击底部导航栏"我的"Tab
3. 进入个人中心页面

**预期结果**：
1. 成功进入个人中心页面
2. 显示用户头像和昵称
3. 显示会员标识"月卡会员"
4. 显示会员到期时间（如"到期时间：2026-02-14"）
5. 显示剩余天数（如"剩余31天"）
6. 显示学习进度
7. 显示卜卦次数统计
8. 显示会员权益（详细解卦、精准解卦、无广告等）
9. 显示续费入口

**备注**：
- 会员用户显示专属权益
- 测试数据需使用月卡会员账号

---

#### 查看个人中心-年卡会员（已过期） ZYT-USER-023

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 用户为年卡会员，但会员已过期
3. 网络连接正常

**测试步骤**：
1. 打开周易通APP
2. 点击底部导航栏"我的"Tab
3. 进入个人中心页面

**预期结果**：
1. 成功进入个人中心页面
2. 显示用户头像和昵称
3. 会员状态显示"已过期"
4. 显示过期时间（如"过期时间：2025-12-14"）
5. 提示"会员已过期，续费后可继续享受权益"
6. 显示重新购买入口
7. 学习进度保留（但不显示会员专属内容）

**备注**：
- 过期会员需引导续费
- 测试边界值场景

---

## 用户信息更新

### 修改昵称

#### 修改昵称-成功 ZYT-USER-024

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 网络连接正常

**测试步骤**：
1. 进入个人中心页面
2. 点击用户头像区域
3. 进入个人信息编辑页面
4. 点击昵称输入框
5. 输入新昵称（如"周易爱好者"）
6. 点击"保存"按钮

**预期结果**：
1. 提示"保存成功"
2. 个人中心页面显示新昵称
3. 数据库中用户昵称已更新
4. 其他页面（如首页）同步显示新昵称

**备注**：
- 昵称长度限制：1-20字符
- 关联需求：PRD-3.2.4

---

#### 修改昵称-为空 ZYT-USER-025

**优先级**：中
**测试类型**：异常

**前置条件**：
1. 用户已登录
2. 用户已有昵称

**测试步骤**：
1. 进入个人信息编辑页面
2. 点击昵称输入框
3. 清空昵称输入框
4. 点击"保存"按钮

**预期结果**：
1. 前端表单验证拦截
2. 提示"昵称不能为空"
3. 不提交保存请求
4. 用户保持原有昵称

**备注**：
- 前端表单验证
- 空值校验

---

#### 修改昵称-超长 ZYT-USER-026

**优先级**：中
**测试类型**：边界值

**前置条件**：
1. 用户已登录

**测试步骤**：
1. 进入个人信息编辑页面
2. 点击昵称输入框
3. 输入21个字符（超过限制）
4. 点击"保存"按钮

**预期结果**：
1. 前端表单验证拦截（或后端验证失败）
2. 提示"昵称长度不能超过20个字符"
3. 保存失败

**备注**：
- 边界值测试：20字符上限
- 测试边界条件

---

### 修改头像

#### 修改头像-成功 ZYT-USER-027

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 手机相册中有图片

**测试步骤**：
1. 进入个人信息编辑页面
2. 点击头像区域
3. 选择"从相册选择"
4. 选择一张图片
5. 点击"确定"或"保存"

**预期结果**：
1. 图片上传成功
2. 提示"头像更新成功"
3. 个人中心显示新头像
4. 数据库中avatar字段更新为新的图片URL
5. 其他页面同步显示新头像

**备注**：
- 支持的图片格式：JPG、PNG
- 文件大小限制：≤5MB

---

#### 修改头像-格式错误 ZYT-USER-028

**优先级**：中
**测试类型**：异常

**前置条件**：
1. 用户已登录
2. 手机中有非标准格式图片（如GIF、BMP）

**测试步骤**：
1. 进入个人信息编辑页面
2. 点击头像区域
3. 选择"从相册选择"
4. 选择GIF格式图片
5. 点击"确定"

**预期结果**：
1. 前端或后端验证失败
2. 提示"不支持该图片格式，请选择JPG或PNG"
3. 上传失败
4. 用户保持原有头像

**备注**：
- 测试无效等价类
- 格式限制验证

---

## 设置功能

### 推送设置

#### 开启每日一卦推送 ZYT-USER-029

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 用户已授权APP推送通知权限
3. 网络连接正常

**测试步骤**：
1. 进入个人中心页面
2. 点击"设置"入口
3. 进入设置页面
4. 找到"每日一卦推送"开关
5. 点击开关，将其从"关"切换为"开"
6. 选择推送时间（如早上8:00）
7. 保存设置

**预期结果**：
1. 提示"设置已保存"
2. 推送开关状态显示为"开启"
3. 显示推送时间"每天08:00"
4. 数据库中push字段更新：enabled=true, dailyHexagram=true, time="08:00"
5. APP在指定时间收到推送通知

**备注**：
- 需要系统推送通知权限
- 关联需求：PRD-3.5.1

---

#### 关闭每日一卦推送 ZYT-USER-030

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 每日一卦推送已开启

**测试步骤**：
1. 进入设置页面
2. 找到"每日一卦推送"开关
3. 点击开关，将其从"开"切换为"关"
4. 保存设置

**预期结果**：
1. 提示"设置已保存"
2. 推送开关状态显示为"关闭"
3. 数据库中push字段更新：dailyHexagram=false
4. 用户不再收到每日一卦推送

**备注**：
- 关闭推送不再接收通知

---

#### 修改推送时间-成功 ZYT-USER-031

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 每日一卦推送已开启

**测试步骤**：
1. 进入设置页面
2. 找到"推送时间"设置项
3. 点击时间选择器
4. 选择新时间（如从08:00改为09:00）
5. 保存设置

**预期结果**：
1. 提示"设置已保存"
2. 显示新的推送时间"每天09:00"
3. 数据库中push.time更新为"09:00"
4. 从次日起，在新的时间点收到推送

**备注**：
- 推送时间可自定义
- 24小时制，格式HH:mm

---

## 账户管理

### 注销账号

#### 请求注销账号-成功 ZYT-USER-032

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 网络连接正常

**测试步骤**：
1. 进入个人中心页面
2. 点击"设置"入口
3. 滚动到页面底部
4. 点击"注销账号"选项
5. 阅读注销提示（将删除所有数据）
6. 点击"确认注销"按钮

**预期结果**：
1. 提示"注销请求已受理"
2. 显示确认码（如"ABC123"）
3. 显示将要删除的数据统计：
   - 卜卦记录：X条
   - 学习进度：X条
   - 订单记录：X条
4. 显示确认码过期时间（24小时后）
5. 提示"请输入确认码以完成注销"

**备注**：
- 两次确认机制，防止误操作
- 注销后数据不可恢复
- 关联需求：PRD-3.2.4

---

#### 确认注销账号-成功 ZYT-USER-033

**优先级**：高
**测试类型**：功能

**前置条件**：
1. 用户已请求注销账号
2. 已获得确认码
3. 确认码未过期（24小时内）

**测试步骤**：
1. 在注销确认页面
2. 输入收到的确认码
3. 勾选"我已知晓注销后将删除所有数据"
4. 点击"确认注销"按钮

**预期结果**：
1. 提示"账户已成功注销，所有数据已被删除"
2. 返回删除统计：
   - 用户账户：1个
   - 卜卦记录：X条
   - 学习进度：X条
   - 订单记录：X条
3. 自动退出登录
4. 跳转至登录页面
5. 使用原账号无法登录

**备注**：
- 注销成功后Token失效
- 所有数据永久删除
- 关键安全操作

---

#### 确认注销-确认码错误 ZYT-USER-034

**优先级**：中
**测试类型**：异常

**前置条件**：
1. 用户已请求注销账号
2. 已获得确认码

**测试步骤**：
1. 在注销确认页面
2. 输入错误的确认码
3. 勾选确认选项
4. 点击"确认注销"按钮

**预期结果**：
1. 提示"确认码错误"
2. 不执行注销操作
3. 用户账号保留

**备注**：
- 确认码验证
- 防止误操作

---

## 会员管理

### 查看会员信息

#### 查看会员信息-免费用户 ZYT-USER-035

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 用户为免费用户

**测试步骤**：
1. 进入个人中心页面
2. 点击"会员中心"或"开通会员"入口
3. 进入会员信息页面

**预期结果**：
1. 显示当前状态"免费用户"
2. 显示会员套餐列表：
   - 月卡：30元/月
   - 季卡：80元/季（优惠11%）
   - 年卡：300元/年（优惠17%）
3. 显示会员权益列表
4. 显示"立即开通"按钮
5. 显示省钱提示（如"开通年卡节省60元"）

**备注**：
- 展示会员权益引导购买
- 关联需求：PRD-3.7.3

---

#### 查看会员信息-付费会员（未过期） ZYT-USER-036

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 用户为年卡会员，未过期

**测试步骤**：
1. 进入个人中心页面
2. 点击"会员中心"入口
3. 进入会员信息页面

**预期结果**：
1. 显示会员类型"年卡会员"
2. 显示会员到期时间（如"2026-01-14到期"）
3. 显示剩余天数（如"剩余365天"）
4. 显示当前享受的会员权益
5. 显示"续费"按钮（而非"开通"）
6. 显示会员专属功能入口

**备注**：
- 付费用户显示续费入口

---

### 订单查询

#### 查询订单列表-成功 ZYT-USER-037

**优先级**：中
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 用户有历史订单记录

**测试步骤**：
1. 进入个人中心页面
2. 点击"我的订单"入口
3. 进入订单列表页面

**预期结果**：
1. 显示订单列表（按时间倒序）
2. 每条订单显示：
   - 订单类型（月卡/季卡/年卡）
   - 订单金额
   - 订单状态（已支付/待支付/已取消）
   - 下单时间
3. 显示订单总数
4. 支持分页加载（每页20条）
5. 点击订单可查看详情

**备注**：
- 订单按创建时间倒序排列
- 支持分页查询

---

## 其他功能

### 联系客服

#### 联系客服-打开对话框 ZYT-USER-038

**优先级**：低
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 网络连接正常

**测试步骤**：
1. 进入个人中心页面
2. 点击"联系客服"入口
3. 选择客服方式（如在线客服）

**预期结果**：
1. 打开客服对话框
2. 显示客服欢迎语
3. 用户可输入问题咨询
4. 支持发送文字、图片

**备注**：
- 客服功能可能为后续版本
- 低优先级功能

---

### 意见反馈

#### 提交意见反馈-成功 ZYT-USER-039

**优先级**：低
**测试类型**：功能

**前置条件**：
1. 用户已登录
2. 网络连接正常

**测试步骤**：
1. 进入个人中心页面
2. 点击"意见反馈"入口
3. 进入反馈页面
4. 选择反馈类型（如功能建议、Bug反馈）
5. 输入反馈内容（如"希望能增加XX功能"）
6. 点击"提交"按钮

**预期结果**：
1. 提示"反馈提交成功，感谢您的建议"
2. 反馈内容上传至服务器
3. 返回个人中心页面

**备注**：
- 意见反馈帮助产品改进
- 低优先级功能

---

#### 提交意见反馈-内容为空 ZYT-USER-040

**优先级**：低
**测试类型**：异常

**前置条件**：
1. 用户已登录

**测试步骤**：
1. 进入意见反馈页面
2. 不输入任何反馈内容
3. 点击"提交"按钮

**预期结果**：
1. 前端表单验证拦截
2. 提示"请输入反馈内容"
3. 不提交请求

**备注**：
- 空值校验
- 低优先级

---

## 附录

### 测试数据

| 数据类型 | 示例值 | 用途 |
|---------|--------|------|
| 免费用户ID | user_free_001 | 免费用户测试 |
| 月卡会员ID | user_month_001 | 月卡会员测试 |
| 年卡会员ID | user_year_001 | 年卡会员测试 |
| 过期会员ID | user_expired_001 | 过期会员测试 |
| 新昵称 | 周易爱好者 | 修改昵称测试 |
| 超长昵称 | 123456789012345678901 | 边界值测试 |
| 错误确认码 | WRONG_CODE | 异常测试 |

### 用户数据字段说明

| 字段 | 类型 | 说明 | 示例值 |
|------|------|------|--------|
| nickname | String | 用户昵称 | "周易爱好者" |
| avatar | String | 头像URL | "https://cdn.example.com/avatar.jpg" |
| membership.type | Enum | 会员类型 | free/monthly/yearly |
| membership.expireAt | Date | 会员到期时间 | 2026-02-14 |
| membership.level | Number | 会员等级 | 0/1/2 |
| stats.divinationCount | Number | 卜卦次数 | 10 |
| stats.learningProgress | Number | 学习进度 | 3 |
| push.enabled | Boolean | 推送总开关 | true |
| push.dailyHexagram | Boolean | 每日一卦推送 | true |
| push.time | String | 推送时间 | "08:00" |

### 测试环境要求

| 环境项 | 要求 |
|--------|------|
| 数据库 | MongoDB 4.4+ |
| Redis | 用于存储确认码 |
| 图片存储 | OSS或本地存储 |
| 推送服务 | 个推/极光推送/厂商推送 |
| 网络环境 | WiFi或4G/5G |

### 相关文档

- PRD文档：`.taskmaster/docs/prd.md`
- 测试用例组织规则：`docs/test-rule/00-【周易通V1.0】测试用例组织规则.md`
- 用户Schema：`src/database/schemas/user.schema.ts`
- 用户服务：`src/services/user/user.service.ts`

---

## 更新记录

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|----------|--------|
| v1.0 | 2026-01-14 | 初始版本，完成20条测试用例设计 | Claude |
